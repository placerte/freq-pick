# handoff.md
# Handoff: Fix freq-pick packaging so `import freq_pick` works when installed from sdist
# Date: 2026-02-23

## Context
Downstream project (`wav-to-freq`) installs `freq-pick` and exposes the `freq-pick` CLI,
but `uv run python -c "import freq_pick"` fails with:
- ModuleNotFoundError: No module named 'freq_pick'

Proof (already observed):
- importlib.metadata shows dist is installed (version resolves)
- dist file list is tiny (≈10 files)
- importlib.util.find_spec('freq_pick') is None

This strongly indicates the published SDist tarball lacks `src/freq_pick/**`.

## Goal
Publish a new `freq-pick` release where BOTH:
- wheel contains `freq_pick` module (already intended), and
- sdist contains `src/freq_pick/**` so installs from `.tar.gz` work.

Also update `wav-to-freq` dependency to avoid hard pin to the sdist URL.

---

## Specs
S-20260223-1: SDist must include the package sources under `src/freq_pick/**`.
S-20260223-2: Release a new version (e.g., 0.1.1) and upload sdist + wheel.
S-20260223-3: `pip install <sdist.tar.gz>` must allow `import freq_pick.core`.
S-20260223-4: `wav-to-freq` must depend on `freq-pick>=0.1.1` (not a direct tarball URL),
             unless there is an explicit reason to keep the URL pin.

---

## Implementation
I-20260223-1: Modify `freq-pick/pyproject.toml` to explicitly include sources in the sdist:

Add:
[tool.hatch.build.targets.sdist]
include = [
  "src/freq_pick/**",
  "pyproject.toml",
  "README.md",
  "LICENSE",
]

Keep/confirm wheel config:
[tool.hatch.build.targets.wheel]
packages = ["freq_pick"]
sources = ["src"]

I-20260223-2: Bump version to 0.1.1 (or next patch) and build artifacts:
- uv build

I-20260223-3: Validate artifacts locally BEFORE upload:
- tar -tf dist/freq_pick-0.1.1.tar.gz | rg "^src/freq_pick/"
- (clean env) pip install dist/freq_pick-0.1.1.tar.gz
- python -c "import freq_pick; import freq_pick.core; print('ok')"

I-20260223-4: Upload both sdist and wheel to PyPI:
- twine upload dist/*

I-20260223-5: Update `wav-to-freq` dependency:
- Replace `freq-pick @ https://files.pythonhosted.org/.../freq_pick-0.1.0.tar.gz`
  with `freq-pick>=0.1.1`
- Run `uv sync`
- Validate:
  uv run python -c "import freq_pick.core; print('ok')"

---

## Tests
T-20260223-1: In `freq-pick` repo, add a CI job that:
- builds sdist
- installs sdist in a clean environment
- imports `freq_pick` and `freq_pick.core`

T-20260223-2: In `wav-to-freq` repo, add a minimal runtime import test (can be a smoke test):
- ensure manual picker path can import `freq_pick.core`
(doesn’t have to run matplotlib UI; import is enough)

---

## Definition of Done
DoD-20260223-1: Installing from sdist tarball succeeds:
- `pip install dist/freq_pick-0.1.1.tar.gz`
- `python -c "import freq_pick.core; print('ok')"` prints ok

DoD-20260223-2: `wav-to-freq` no longer needs a direct tarball URL pin for freq-pick and
`uv run wav-to-freq ...` does not raise `ModuleNotFoundError: freq_pick`.

---

## Notes / gotchas for the agent
- The presence of `.venv/bin/freq-pick` only proves the dist metadata/entrypoint exists,
  not that the module files shipped.
- Wheel settings do not guarantee SDist contents; SDist must be explicitly configured.
- If you need a temporary unblock, use editable install:
  uv add --editable ../freq-pick

